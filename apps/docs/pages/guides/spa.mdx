import { Tabs, Callout } from "nextra-theme-docs"

# SPA 

This plugin provides 1st class support for Single Page Applications (SPA).

<Callout type="info">
Examples of SPA's are React, Vue, Svelte, etc
</Callout>

## What problem does this plugin solve?
The issue with SPA's is that they don't have a server that the application runs on to generate a unique `nonce` for each request. This means that you can't use [nonce based CSPs](https://content-security-policy.com/nonce/). 
This plugin solves this issue by using the alternative [hash based CSP](https://content-security-policy.com/hash/) instead, which is the only way to secure your SPA without a server.

## Installation

<Tabs items={['npm', 'yarn', 'pnpm']} defaultIndex="1">
  <Tabs.Tab>
  ```bash
npm install -D vite-plugin-hash-csp -
  ```
  </Tabs.Tab>
  <Tabs.Tab>
  ```bash 
yarn add -D vite-plugin-hash-csp
    ```
  </Tabs.Tab>
  <Tabs.Tab>
  ```bash
pnpm add -D vite-plugin-hash-csp
  ```
  </Tabs.Tab>
</Tabs>


## Usage

```ts

import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import csp from "vite-plugin-hash-csp";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    react(),
    csp({
      dev: {
        run: true,  // Run the plugin in dev mode
      },   
      policy: {
        "script-src": ["'self'", "https://www.google-analytics.com"],    //Allow google analytics to run
        "font-src": ["'self'", "https://fonts.gstatic.com"],    //Allows fonts from Google to load
      }
    }),
  ],
});

```

### Additional support

If you are using any pre-processors like (e.g. `sass`, etc) or `tailwind`. You will need to tell the plugin this, because these require additional support when running `vite dev`
You can do this by adding the `outlierSupport` key to the plugin options. 

```ts

import { defineConfig, PluginOption } from "vite";
import react from "@vitejs/plugin-react";
import csp from "vite-plugin-hash-csp";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    react(),
    csp({
      dev: {
        run: true,
        outlierSupport: ["less"], 
      },
    })
  ]
});

```


### Caveats

If you are using a library that dynamically injects css into the page (e.g. `styled-components`, `emotion`, or `MUI`), you will need to set your `style-elem-src` policy to include `'unsafe-inline'`.

The only other alternative is to move to a server and use nonce based CSPs.

We are actively working to find a solution to this [issue](https://github.com/RockiRider/vite-plugin-hash-csp/issues/2), and there isn't much support for hash based CSPs in those libraries yet.

<Callout type="warning">
    There are risks to using `'unsafe-inline'` for your styles. But most of these can be mitigated by the rest of the CSP. [Read more about this here](https://scotthelme.co.uk/can-you-get-pwned-with-css/)
</Callout>


## Maintenance 

This is one of the most difficult parts of CSPs. They are very easy to get wrong, and can break your site if you aren't careful.
- Adding `vite dev` support via `run.dev` flag is a great way to test your new third party scripts work before deploying it to production.
- We will be developing eslint rules to help you catch common mistakes in your CSPs. Watch this space!

